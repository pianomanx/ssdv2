---
pgrole: 'decypharr'
intport: '8282'
image: 'cy01/blackhole:latest'
pg_volumes:
  - "{{ settings.storage }}/docker/{{ lookup('env','USER') }}/decypharr/config:/app"
  - "{{ lookup('env','HOME') }}:{{ lookup('env','HOME') }}:rw"
  - "/mnt:/mnt:rshared"
pg_env:
  PUID: "{{ lookup('env','MYUID') }}"
  PGID: "{{ lookup('env','MYGID') }}"
specific_docker_info:
  devices:
    - '/dev/fuse:/dev/fuse:rwm'
  capabilities:
    - SYS_ADMIN
    - NET_ADMIN 
  security_opts:
    - apparmor:unconfined
  ports:
    - "8282:8282"
  restart_policy: "always"
  healthcheck:
    test: >
      /bin/sh -c "
      if ping -c 1 -W 1 172.18.0.250 >/dev/null 2>&1; then
        ip route | grep -q 'default via 172.18.0.250' || ip route replace default via 172.18.0.250;
      fi;
      wget -qO- --timeout=2 http://localhost:8282/health 2>/dev/null || exit 0
      "
    interval: "30s"
    timeout: "10s"
    retries: 3
    start_period: "10s"